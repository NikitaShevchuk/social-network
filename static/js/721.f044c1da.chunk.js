(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[721],{6721:function(e,n,s){"use strict";s.r(n),s.d(n,{default:function(){return D}});var t=s(8683),r=s(2791),a=s(9070),i=s(6871),o=s(220),c=s(5078);var l=s.p+"static/media/send.2ec83b7d2370fbd448eddc161ecfe473.svg",u=s(184),d=function(e){var n=e.sendMessage;return(0,u.jsx)("div",{className:"message-text-container",children:(0,u.jsx)(c.l0,{onSubmit:n,render:function(e){var n=e.handleSubmit,s=e.submitting,t=e.pristine,r=e.form;return(0,u.jsxs)("form",{className:"add-message-form",onSubmit:n,children:[(0,u.jsx)(c.gN,{onKeyDown:function(e){return function(e,n){"Enter"===e.key&&(e.preventDefault(),n.submit(),n.reset())}(e,r)},name:"body",component:"textarea",placeholder:"Text a message"}),(0,u.jsx)("button",{disabled:s||t,onClick:function(){return function(e){e.submit(),e.reset()}(r)},children:(0,u.jsx)("img",{src:l,alt:""})})]})}})})},f=s(8687),m=s(6083),g=s(3504),h=(0,f.$j)((function(e){return{conversationHead:e.messagesPage.conversationHead}}),{})((function(e){var n=e.conversationHead,s=n.photo?n.photo:m;return(0,u.jsxs)(g.OL,{replace:!0,to:"/profile/".concat(n.id),className:"conversation-head",children:[(0,u.jsx)("figure",{children:(0,u.jsx)("img",{src:s,alt:""})}),(0,u.jsx)("span",{children:n.userName})]})})),v=s(885),p=s(5095),j=s.n(p),x=function(e){if(!e)return!1;var n=e.scrollHeight-e.offsetHeight-32;return e.scrollTop+70<n},b=function(e,n,s,t){var a=(0,r.useRef)(null);(0,r.useEffect)((function(){!function(e){e&&(x(e)||(e.scrollTop=e.scrollHeight))}(a.current)}),[e]);var i=(0,r.useRef)(!1);(0,r.useEffect)((function(){n||i.current||(a.current&&(a.current.scrollTop=a.current.scrollHeight),i.current=!0)}),[n]);var o=(0,r.useState)(!1),c=(0,v.Z)(o,2),l=c[0],u=c[1],d=(0,r.useCallback)(j()(s,500),[]);(0,r.useEffect)((function(){a.current&&!t&&(a.current.scrollTop=1100)}),[t]);return{chatRef:a,handleScrollClick:function(){var e;a.current&&a.current.scroll({top:null===(e=a.current)||void 0===e?void 0:e.scrollHeight,behavior:"smooth"})},handleScroll:function(){(x(a.current)?!l&&u(!0):l&&u(!1),a.current)&&(a.current.scrollTop<30&&i&&d())},showScrollButton:l}},A=function(e){var n=e.messages,s=e.sendNewMessage,t=e.isMessagesLoading,r=e.loadMoreMessages,a=e.isMessagesFetching,c=Number((0,i.UO)().userId),l=b(n,t,r,a),f=l.chatRef,m=l.handleScrollClick,g=l.handleScroll,v=l.showScrollButton;return(0,u.jsxs)("div",{className:"peoples-mesg-box",children:[c&&(0,u.jsxs)("div",{className:"chatArea opacity-animation",children:[(0,u.jsx)(h,{}),(0,u.jsxs)("ul",{className:"chatting-area",ref:f,onScroll:g,children:[(0,u.jsx)(o.Z,{isFetching:a,size:"small"}),t&&(0,u.jsx)(o.Z,{}),n[0]?!t&&n:!t&&(0,u.jsx)("div",{className:"preloader",children:"You've got no messages yet."})]}),v&&(0,u.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAAAiElEQVRIie3WOwqAMAyAYfEOFr3/TRxUxMkOHud3iRgEH2jEB8mYpv0S2qFJ8rUAGqB6Agbg7P7UshmHHXbYYYcddtjhH8BACXRA2KgJUlObdQe08reLE64/e4JGSbWWcAb0cvAAFMyxXMvNYMH1VFHBOrd6FVdxPZ0O+0kP4PejC7zbe+mvjBGLFdw2IJ6KXAAAAABJRU5ErkJggg==",alt:"",className:"scroll-bottom opacity-animation",onClick:m}),(0,u.jsx)(d,{sendMessage:function(e){return s(e)}})]}),!c&&(0,u.jsx)("div",{className:"fetch-error",children:"Choose friend to start chat"})]})},N=s(4025),y=s(3483),M=s(1363),S=s(3174),w=function(e){var n=e.searchMode,s=e.setSearchMode;return(0,u.jsxs)("div",{className:"sidebarHeader",children:[n&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"text opacity-animation",children:"Find people"}),(0,u.jsx)(M.G,{className:"opacity-animation",onClick:function(){return s(!1)},icon:S.g82})]}),!n&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"text opacity-animation",children:"Messages"}),(0,u.jsx)(M.G,{className:"opacity-animation",onClick:function(){return s(!0)},icon:S.g6h})]})]})},O=s(1544),C=s(2519),E=function(e){var n=e.filterDialogs,s=e.setDialogs,t=Number((0,i.UO)().userId);return(0,u.jsxs)("div",{className:"search-users pointer",children:[(0,u.jsx)(M.G,{icon:S.wn1}),(0,u.jsx)(c.l0,{onSubmit:function(e){n(e.searchBody)},render:function(e){var n=e.handleSubmit,r=e.form;return(0,u.jsx)("form",{onSubmit:n,children:(0,u.jsx)(c.gN,{name:"searchBody",autoFocus:!0,validate:O.C1,onKeyUp:function(e){return function(e,n){(0,C.j)(e,n,s,t),n.submit()}(e,r)},component:"input",placeholder:"Find dialog by name",className:"search-users__input"})})}})]})},F=s(2032),H=(0,f.$j)((function(e){return{}}),{getDialog:a.Yq,filterDialogs:a.J_})((function(e){var n=e.filterDialogs,s=e.getDialog,t=(0,r.useState)(!1),i=(0,v.Z)(t,2),o=i[0],c=i[1];return(0,u.jsxs)("ul",{className:"peoples",children:[(0,u.jsx)(w,{searchMode:o,setSearchMode:c}),(0,u.jsx)("div",{className:o?"shown":"hidden",children:(0,u.jsx)(y.Z,{setSearchMode:c,getDialog:s})}),(0,u.jsxs)("div",{className:o?"hidden":"shown",children:[(0,u.jsx)(E,{setDialogs:a.ow,filterDialogs:n}),(0,u.jsx)("div",{className:"dialogs-list",children:(0,u.jsx)(F.Z,{})})]})]})})),k=s(6399),D=(0,f.$j)((function(e){return{messages:(0,N.xq)(e),totalMessagesCount:(0,N.bp)(e),isMessagesLoading:(0,N.FC)(e),pageNumber:(0,N.p6)(e),isMessagesFetching:(0,N._L)(e)}}),{sendNewMessage:a.J,loadMessages:a.EV,fetchMessages:a.W4,setPageNumber:k.oW,loadMoreMessages:a.hG,setDialogUserId:k.lG})((function(e){var n=Number((0,i.UO)().userId);return(0,r.useEffect)((function(){n&&(e.setDialogUserId(n),e.loadMessages());var s=!!n&&setInterval((function(){return e.fetchMessages()}),1e3);return function(){s&&clearInterval(s)}}),[n]),(0,u.jsx)("div",{className:"central-meta messages",children:(0,u.jsx)("div",{className:"messages",children:(0,u.jsxs)("div",{className:"message-box",children:[(0,u.jsx)(H,{}),(0,u.jsx)(A,(0,t.Z)({},e))]})})})}))},5095:function(e,n,s){var t=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,i=/^0o[0-7]+$/i,o=parseInt,c="object"==typeof s.g&&s.g&&s.g.Object===Object&&s.g,l="object"==typeof self&&self&&self.Object===Object&&self,u=c||l||Function("return this")(),d=Object.prototype.toString,f=Math.max,m=Math.min,g=function(){return u.Date.now()};function h(e){var n=typeof e;return!!e&&("object"==n||"function"==n)}function v(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==d.call(e)}(e))return NaN;if(h(e)){var n="function"==typeof e.valueOf?e.valueOf():e;e=h(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(t,"");var s=a.test(e);return s||i.test(e)?o(e.slice(2),s?2:8):r.test(e)?NaN:+e}e.exports=function(e,n,s){var t,r,a,i,o,c,l=0,u=!1,d=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function j(n){var s=t,a=r;return t=r=void 0,l=n,i=e.apply(a,s)}function x(e){return l=e,o=setTimeout(A,n),u?j(e):i}function b(e){var s=e-c;return void 0===c||s>=n||s<0||d&&e-l>=a}function A(){var e=g();if(b(e))return N(e);o=setTimeout(A,function(e){var s=n-(e-c);return d?m(s,a-(e-l)):s}(e))}function N(e){return o=void 0,p&&t?j(e):(t=r=void 0,i)}function y(){var e=g(),s=b(e);if(t=arguments,r=this,c=e,s){if(void 0===o)return x(c);if(d)return o=setTimeout(A,n),j(c)}return void 0===o&&(o=setTimeout(A,n)),i}return n=v(n)||0,h(s)&&(u=!!s.leading,a=(d="maxWait"in s)?f(v(s.maxWait)||0,n):a,p="trailing"in s?!!s.trailing:p),y.cancel=function(){void 0!==o&&clearTimeout(o),l=0,t=c=r=o=void 0},y.flush=function(){return void 0===o?i:N(g())},y}}}]);
//# sourceMappingURL=721.f044c1da.chunk.js.map