(self.webpackChunksocial_network=self.webpackChunksocial_network||[]).push([[235],{7235:function(e,n,s){"use strict";s.r(n),s.d(n,{default:function(){return D}});var t=s(8683),r=s(2791),o=s(6871),i=s(8687),a=s(885),c=s(3483),l=s(9070),u=s(1363),d=s(3174),f=s(184),m=function(e){var n=e.searchMode,s=e.setSearchMode;return(0,f.jsxs)("div",{className:"sidebarHeader",children:[n&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{className:"text opacity-animation",children:"Find people"}),(0,f.jsx)(u.G,{className:"opacity-animation",onClick:function(){return s(!1)},icon:d.g82})]}),!n&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{className:"text opacity-animation",children:"Messages"}),(0,f.jsx)(u.G,{className:"opacity-animation",onClick:function(){return s(!0)},icon:d.g6h})]})]})},h=s(5078),g=s(1544),p=s(2519),v=function(e){var n=e.filterDialogs,s=e.setDialogs,t=Number((0,o.UO)().userId);return(0,f.jsxs)("div",{className:"search-users pointer",children:[(0,f.jsx)(u.G,{icon:d.wn1}),(0,f.jsx)(h.l0,{onSubmit:function(e){n(e.searchBody)},render:function(e){var n=e.handleSubmit,r=e.form;return(0,f.jsx)("form",{onSubmit:n,children:(0,f.jsx)(h.gN,{name:"searchBody",autoFocus:!0,validate:g.C1,onKeyUp:function(e){return function(e,n){(0,p.j)(e,n,s,t),n.submit()}(e,r)},component:"input",placeholder:"Find dialog by name",className:"search-users__input"})})}})]})},j=s(2032),x=(0,i.$j)((function(e){return{}}),{getDialog:l.Yq,filterDialogs:l.J_})((function(e){var n=e.filterDialogs,s=e.getDialog,t=(0,r.useState)(!1),o=(0,a.Z)(t,2),i=o[0],u=o[1];return(0,f.jsxs)("ul",{className:"peoples",children:[(0,f.jsx)(m,{searchMode:i,setSearchMode:u}),(0,f.jsx)("div",{className:i?"shown":"hidden",children:(0,f.jsx)(c.Z,{setSearchMode:u,getDialog:s})}),(0,f.jsxs)("div",{className:i?"hidden":"shown",children:[(0,f.jsx)(v,{setDialogs:l.ow,filterDialogs:n}),(0,f.jsx)("div",{className:"dialogs-list",children:(0,f.jsx)(j.Z,{})})]})]})})),A=s(220);var b=s.p+"static/media/send.2ec83b7d2370fbd448eddc161ecfe473.svg",y=function(e){var n=e.sendMessage;return(0,f.jsx)("div",{className:"message-text-container",children:(0,f.jsx)(h.l0,{onSubmit:n,render:function(e){var n=e.handleSubmit,s=e.submitting,t=e.pristine,r=e.form;return(0,f.jsxs)("form",{className:"add-message-form",onSubmit:n,children:[(0,f.jsx)(h.gN,{onKeyDown:function(e){return function(e,n){"Enter"===e.key&&(e.preventDefault(),n.submit(),n.reset())}(e,r)},name:"body",component:"textarea",placeholder:"Text a message"}),(0,f.jsx)("button",{disabled:s||t,onClick:function(){return function(e){e.submit(),e.reset()}(r)},children:(0,f.jsx)("img",{src:b,alt:""})})]})}})})},N=s(6083),S=s(3504),M=(0,i.$j)((function(e){return{conversationHead:e.messagesPage.conversationHead}}),{})((function(e){var n=e.conversationHead,s=n.photo?n.photo:N;return(0,f.jsxs)(S.OL,{replace:!0,to:"/profile/".concat(n.id),className:"conversation-head",children:[(0,f.jsx)("figure",{children:(0,f.jsx)("img",{src:s,alt:""})}),(0,f.jsx)("span",{children:n.userName})]})})),U=s(5095),F=s.n(U),w=function(e){if(!e)return!1;var n=e.scrollHeight-e.offsetHeight-32;return e.scrollTop+70<n},T=function(e,n,s,t){(0,r.useEffect)((function(){!function(e){e&&(w(e)||(e.scrollTop=e.scrollHeight))}(n.current)}),[e]),(0,r.useEffect)((function(){t.isLoading||s.current||(n.current&&(n.current.scrollTop=n.current.scrollHeight),s.current=!0)}),[t.isLoading]),(0,r.useEffect)((function(){var e=!t.isFetching&&!t.allMessagesIsLoaded;n.current&&e&&(n.current.scrollTop=1100)}),[t.isFetching])},H=function(e){var n=e.messages,s=e.sendNewMessage,t=e.status,i=e.loadMoreMessages,c=Number((0,o.UO)().userId),l=(0,r.useRef)(null),u=(0,r.useRef)(!1);T(n,l,u,t);var d=function(e,n,s){var t=(0,r.useState)(!1),o=(0,a.Z)(t,2),i=o[0],c=o[1],l=(0,r.useCallback)(F()(e,500),[]);return{handleScrollClick:function(){var e;n.current&&n.current.scroll({top:null===(e=n.current)||void 0===e?void 0:e.scrollHeight,behavior:"smooth"})},handleScroll:function(){w(n.current)?!i&&c(!0):i&&c(!1),n.current&&n.current.scrollTop<30&&s&&l()},showScrollButton:i}}(i,l,u),m=d.handleScrollClick,h=d.handleScroll,g=d.showScrollButton;return(0,f.jsxs)("div",{className:"peoples-mesg-box",children:[c&&(0,f.jsxs)("div",{className:"chatArea opacity-animation",children:[(0,f.jsx)(M,{}),(0,f.jsxs)("ul",{className:"chatting-area",ref:l,onScroll:h,children:[(0,f.jsx)(A.Z,{isFetching:t.isFetching,size:"small"}),t.isLoading&&(0,f.jsx)(A.Z,{}),n[0]?!t.isLoading&&n:!t.isLoading&&(0,f.jsx)("div",{className:"preloader",children:"You've got no messages yet."})]}),g&&(0,f.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAO8SURBVFhH7ZlLaBNRFIY7kzRJ0yRto5FuFMQWBZcqKFaQUq21FoQq4mPhA0QX4rJuRNduBHc+qAiKUFHUUh8VEZcuWgQVUSuKCwVj0iapTdO8/M7kVtT0kSbTOoV+kOTce2bu/efcd0Yr+wNd15e43e4TTqdzh91ur9c0rVK55oRsNvszlUq9TyQSPSMjIxcymUxQucp+C3W5XLuqqqo6EedVWf8VREcjkcih0dHRO5K2yZeIrK6u7kKkU9JWQLSgazcRfs3nrSbNHQgEBqwSyX8hspFgMFhvq6ysPEWf3KLyLQcBdCE2rhPeNpVnWQhkm26z2VaotGVhBqrTCa1HpS2LjB9d2ZZnQajZLAg1m/kvNBQKbeSzlh3MV5U1a0gd1LUmHA5vUll5TBXRsWQy2SeC0+n0B5VnOlK21EFd/SyVCZWdx6RC2U31OhwOEfmZgjZQ0AvlMo2xsbF+ym6QOsrLy9dR5wPlymNSoSytNSKWdXYbTROiWZoo+Ilylwyb4+eDg4ONlP2dgDT6/f6n1LlYufOYcjCxBXSzmb7HxmUPzTJMwW1sZG8pd9Eg8v7Q0FCLbOEoeycB6ZlumzmlUAGxDgq6yRHlpPQhKtjLMeGScs8Y7r3GA7fL1o0yj1H2bepwKfek2Dwez1llT4UmXYCnrpDmlzONZNJkmw1vgcg5KBqNHsfMsA/u8Pl857GnDZZQqFADhDXw9IsQ+hjBz+hfYR6gGddfh8QJyMZisY7h4eHT2JrX6z1HvWfENrwFoNXW1maVXTDxePw6B6/DmMmKior99OOr2OWGM5801x7lnk5sG9de5J4jOVfhFCVUIKrd9FcZZHGi2oqALhl8ym1AxBM09T45SdJtnFxzg8HTrtwzoqD+MRFyPGAgPESAT/qsTDXMhyHlFpE8x1CTEumpqanpLlakUHREx6Gv9iFou8yHHBlWI/4RkbUjvIVF4iW2H5E9TOjr1S1FUbJQAUHvELuViH5h0l4uedifsJchvBeRK40LS8AUoQIR/cbq1ZxKpV5JmuiuEpH8LjUuKBHThApEMUxkWzGT0n+JaCDnKR1ThQrMAjH5nW5JnClFj/rJEIFmixRMFzpbLAg1m/kjdHyUWhk0RnUm6I8qbVlY+QZ02QWptGVhP9Etf40H1F/jPpVvKWh2+Wu8TmeNDsrbB/IyOZelyKDtIBp/GG9F5K2DvH1Q56JpD1pzgUQS9rOfvStpQ6ggYjkuXOGCUZJeuoQshY6cd26QGYiB8wYdlxF5ALs/5ykr+wUuwtPz9MCTQwAAAABJRU5ErkJggg==",alt:"",className:"scroll-bottom opacity-animation",onClick:m}),(0,f.jsx)(y,{sendMessage:function(e){return s(e)}})]}),!c&&(0,f.jsx)("div",{className:"fetch-error",children:"Choose friend to start chat"})]})},Q=s(4025),k=s(6399),D=(0,i.$j)((function(e){return{messages:(0,Q.xq)(e),totalMessagesCount:(0,Q.bp)(e),pageNumber:(0,Q.p6)(e),status:(0,Q.RL)(e)}}),{sendNewMessage:l.J,loadMessages:l.EV,fetchMessages:l.W4,setIsAllMessagesLoaded:k.BR,setPageNumber:k.oW,loadMoreMessages:l.hG,setDialogUserId:k.lG})((function(e){var n=Number((0,o.UO)().userId);return(0,r.useEffect)((function(){n&&(e.setDialogUserId(n),e.loadMessages());var s=!!n&&setInterval((function(){return e.fetchMessages()}),1500);return function(){s&&clearInterval(s)}}),[n]),(0,f.jsx)("div",{className:"central-meta messages",children:(0,f.jsx)("div",{className:"messages",children:(0,f.jsxs)("div",{className:"message-box",children:[(0,f.jsx)(x,{}),(0,f.jsx)(H,(0,t.Z)({},e))]})})})}))},5095:function(e,n,s){var t=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,i=/^0o[0-7]+$/i,a=parseInt,c="object"==typeof s.g&&s.g&&s.g.Object===Object&&s.g,l="object"==typeof self&&self&&self.Object===Object&&self,u=c||l||Function("return this")(),d=Object.prototype.toString,f=Math.max,m=Math.min,h=function(){return u.Date.now()};function g(e){var n=typeof e;return!!e&&("object"==n||"function"==n)}function p(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==d.call(e)}(e))return NaN;if(g(e)){var n="function"==typeof e.valueOf?e.valueOf():e;e=g(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(t,"");var s=o.test(e);return s||i.test(e)?a(e.slice(2),s?2:8):r.test(e)?NaN:+e}e.exports=function(e,n,s){var t,r,o,i,a,c,l=0,u=!1,d=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function j(n){var s=t,o=r;return t=r=void 0,l=n,i=e.apply(o,s)}function x(e){return l=e,a=setTimeout(b,n),u?j(e):i}function A(e){var s=e-c;return void 0===c||s>=n||s<0||d&&e-l>=o}function b(){var e=h();if(A(e))return y(e);a=setTimeout(b,function(e){var s=n-(e-c);return d?m(s,o-(e-l)):s}(e))}function y(e){return a=void 0,v&&t?j(e):(t=r=void 0,i)}function N(){var e=h(),s=A(e);if(t=arguments,r=this,c=e,s){if(void 0===a)return x(c);if(d)return a=setTimeout(b,n),j(c)}return void 0===a&&(a=setTimeout(b,n)),i}return n=p(n)||0,g(s)&&(u=!!s.leading,o=(d="maxWait"in s)?f(p(s.maxWait)||0,n):o,v="trailing"in s?!!s.trailing:v),N.cancel=function(){void 0!==a&&clearTimeout(a),l=0,t=c=r=a=void 0},N.flush=function(){return void 0===a?i:y(h())},N}}}]);
//# sourceMappingURL=235.8255da19.chunk.js.map