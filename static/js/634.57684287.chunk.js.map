{"version":3,"file":"static/js/634.57684287.chunk.js","mappings":"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","sources":["components/MainContent/Messages/Dialogs/SidebarHeader.tsx","components/MainContent/Messages/Dialogs/DialogsSearchForm.tsx","components/MainContent/Messages/Dialogs/Dialogs.tsx","redux/reducers/messages-reducer/actions.ts","redux/reducers/messages-reducer/middleware.ts","common/assets/img/send.svg","components/MainContent/Messages/NewMessage.tsx","components/MainContent/Messages/ConversationHead.tsx","components/MainContent/Messages/hooks.ts","components/MainContent/Messages/Messages.tsx","components/MainContent/Messages/MessagesContainer.tsx"],"sourcesContent":["import React, {FC} from 'react';\r\nimport {FontAwesomeIcon} from \"@fortawesome/react-fontawesome\";\r\nimport {faSquarePlus, faXmark} from \"@fortawesome/free-solid-svg-icons\";\r\n\r\ninterface Props {\r\n    searchMode: boolean\r\n    setSearchMode: (isSearchMode: boolean) => void\r\n}\r\n\r\nconst SidebarHeader: FC<Props> = ({searchMode, setSearchMode}) => {\r\n    const closeSearch = () => setSearchMode(false)\r\n    const openSearch = () => setSearchMode(true)\r\n    return (\r\n        <div className=\"sidebarHeader\">\r\n            {searchMode && <>\r\n                <span className=\"text opacity-animation\">Find people</span>\r\n                <FontAwesomeIcon\r\n                    className='opacity-animation'\r\n                    onClick={closeSearch}\r\n                    icon={faXmark}\r\n                />\r\n            </>}\r\n            {!searchMode && <>\r\n                <span className=\"text opacity-animation\">Messages</span>\r\n                <FontAwesomeIcon\r\n                    className='opacity-animation'\r\n                    onClick={openSearch}\r\n                    icon={faSquarePlus}\r\n                />\r\n            </>}\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default SidebarHeader;","import React, {FC} from 'react';\r\nimport {FontAwesomeIcon} from \"@fortawesome/react-fontawesome\";\r\nimport {faSearch} from \"@fortawesome/free-solid-svg-icons\";\r\nimport {Field, Form} from \"react-final-form\";\r\nimport {required} from \"../../../../common/helpers/validators\";\r\nimport {isSearchFieldEmpty} from \"../../../../common/FormControl/formHelpers\";\r\nimport {FormApi} from \"final-form\";\r\nimport {useParams} from \"react-router-dom\";\r\n\r\ninterface Props {\r\n    setDialogs: (id: number) => void\r\n    filterDialogs: (userName: string) => void\r\n}\r\n\r\nexport interface SearchDialogsFormValues {\r\n    searchBody: string\r\n}\r\n\r\nconst DialogsSearchForm: FC<Props> = ({filterDialogs, setDialogs}) => {\r\n    const userId = Number(useParams().userId);\r\n    const dialogsSearch = (formData: any) => {\r\n        filterDialogs(formData.searchBody)\r\n    }\r\n    const handleKeyUp = (e: KeyboardEvent, form: FormApi<SearchDialogsFormValues>) => {\r\n        isSearchFieldEmpty(e, form, setDialogs, userId)\r\n        form.submit()\r\n    }\r\n    return (\r\n        <div className=\"search-users pointer\">\r\n            <FontAwesomeIcon icon={faSearch} />\r\n            <Form\r\n                onSubmit={dialogsSearch}\r\n                render={\r\n                    ({handleSubmit, form}) => (\r\n                        <form onSubmit={handleSubmit}>\r\n                            <Field\r\n                                name='searchBody'\r\n                                autoFocus validate={required}\r\n                                onKeyUp={(e: KeyboardEvent) => handleKeyUp(e, form)}\r\n                                component='input'\r\n                                placeholder='Find dialog by name'\r\n                                className=\"search-users__input\"\r\n                            />\r\n                        </form>\r\n                    )}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default DialogsSearchForm;","import React, {FC, useState} from \"react\";\r\nimport UsersContainer from \"../../../../features/Users/UsersContainer\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport {RootState} from \"../../../../redux/redux-store\";\r\nimport {filterDialogs, setDialogs} from \"../../../../redux/reducers/dialogs-reducer/middleware\";\r\nimport SidebarHeader from \"./SidebarHeader\";\r\nimport DialogsSearchForm from \"./DialogsSearchForm\";\r\nimport DialogsList from \"../../../../features/DialogsList\";\r\n\r\nconst Dialogs: FC<DialogsConnectedProps> = ({filterDialogs, setDialogs}) => {\r\n    const [searchMode, setSearchMode] = useState(false);\r\n    return (\r\n        <ul className=\"peoples\">\r\n            <SidebarHeader\r\n                searchMode={searchMode}\r\n                setSearchMode={setSearchMode}\r\n            />\r\n            <div className={searchMode ? 'shown' : 'hidden'}>\r\n                <UsersContainer\r\n                    setSearchMode={setSearchMode}\r\n                    startDialogOnClick={true}\r\n                />\r\n            </div>\r\n            <div className={!searchMode ? 'shown' : 'hidden'}>\r\n                <DialogsSearchForm\r\n                    setDialogs={setDialogs}\r\n                    filterDialogs={filterDialogs}\r\n                />\r\n                <DialogsList className='messages-page-dialogs' />\r\n            </div>\r\n        </ul>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({})\r\n\r\nconst connector = connect(mapStateToProps, {filterDialogs, setDialogs})\r\n\r\nexport default connector(Dialogs)\r\nexport type DialogsConnectedProps = ConnectedProps<typeof connector>","import {Message} from \"../../../types/MessagesTypes\";\r\nimport {InferActionsTypes} from \"../../redux-store\";\r\n\r\nexport const messagesActions = {\r\n    \r\n    setDialogUserId: (userId: number) => ({type: 'messages-reducer/SET_DIALOG_USER_ID', userId} as const),\r\n    setMoreMessages: (messages: Message[]) => ({type: 'messages-reducer/SET_MORE_MESSAGES', messages} as const),\r\n    setMessages: (messages: Message[]) => ({type: 'messages-reducer/SET_MESSAGES', messages} as const),\r\n    setTotalMessagesCount: (count: number) => ({type: 'messages-reducer/SET_TOTAL_MESSAGES_COUNT', count} as const),\r\n    updateMessages: (newMessages: Message[]) => ({type: 'messages-reducer/UPDATE_MESSAGES', newMessages} as const),\r\n    addNewMessage: (newMessage: Message) => ({type: 'messages-reducer/ADD_NEW_MESSAGE', newMessage} as const),\r\n    setPageNumber: (pageNumber: number) => ({type: 'messages-reducer/SET_PAGE_NUMBER', pageNumber} as const),\r\n    setCount: (count: number) => ({type: 'messages-reducer/SET_COUNT', count} as const),\r\n    setIsAllMessagesLoaded: (isLoaded: boolean) => ({type: 'messages-reducer/SET_IS_MESSAGES_LOADED', isLoaded} as const),\r\n\r\n    // Errors handle\r\n    setMessagesError: (errorText: string) => ({type: 'messages-reducer/SET_MESSAGES_ERROR', errorText} as const),\r\n    clearMessagesError: () => ({type: 'messages-reducer/CLEAR_MESSAGES_ERROR'} as const),\r\n\r\n    // Set is loading\r\n    setIsMessagesLoading: (isLoading: boolean) => ({type: 'messages-reducer/SET_IS_MESSAGES_LOADING', isLoading} as const),\r\n    setIsMessagesFetching: (isFetching: boolean) => ({type: 'messages-reducer/SET_IS_MESSAGES_FETCHING', isFetching} as const),\r\n}\r\n\r\nexport const {setPageNumber, setDialogUserId, setIsAllMessagesLoaded} = messagesActions\r\n\r\nexport type MessagesActionsType = InferActionsTypes<typeof messagesActions>","import {messagesActions} from \"./actions\";\r\nimport {Message, NewMessageFormData} from \"../../../types/MessagesTypes\";\r\nimport {dialogsService} from \"../../../services/dialogsService\";\r\nimport {AsyncThunk} from \"../../Models\";\r\nimport {ResultCodes} from \"../../../services\";\r\nimport {appActions} from \"../app-reducer/actions\";\r\nimport {dialogsActions} from \"../dialogs-reducer/actions\";\r\n\r\nconst getDate = (): string => {\r\n    const date = new Date()\r\n    date.setHours(date.getHours() - 12, 0, 0, 0)\r\n    return date.toISOString()\r\n}\r\n\r\n\r\nexport const loadMessagesByDate = (date: string = getDate()): AsyncThunk => async (dispatch, getState)=> {\r\n    const id = getState().messagesPage.dialogUserId\r\n    dispatch(messagesActions.setIsMessagesLoading(true))\r\n    try {\r\n        const messagesResponse = await dialogsService.requireMessagesByDate(id, date)\r\n        dispatch(messagesActions.setMessages(messagesResponse.items))\r\n    } catch {\r\n        dispatch(appActions.addError(\"Can't load messages\"))\r\n    }\r\n    dispatch(messagesActions.setIsMessagesLoading(false))\r\n}\r\n\r\nexport const changeChat = (): AsyncThunk => (dispatch, getState) => {\r\n    const {dialogUserId} = getState().messagesPage\r\n    dispatch(messagesActions.setPageNumber(1))\r\n    dispatch(messagesActions.setIsAllMessagesLoaded(false))\r\n    dispatch(messagesActions.clearMessagesError())\r\n    dispatch(dialogsActions.setConversationHead(dialogUserId))\r\n}\r\n\r\nexport const loadMessages = (): AsyncThunk => async (dispatch, getState)=> {\r\n    dispatch(messagesActions.setIsMessagesLoading(true))\r\n    const {dialogUserId} = getState().messagesPage\r\n    dispatch(changeChat())\r\n    try {\r\n        const {count} = getState().messagesPage\r\n        const messagesResponse = await dialogsService.requireMessages(dialogUserId, count, 1)\r\n        dispatch(messagesActions.setMessages(messagesResponse.items))\r\n        dispatch(messagesActions.setTotalMessagesCount(messagesResponse.totalCount))\r\n    } catch {\r\n        dispatch(appActions.addError(\"Can't load messages\"))\r\n    }\r\n    dispatch(messagesActions.setIsMessagesLoading(false))\r\n}\r\n\r\n\r\nconst isLastMessageIdEqual = (messages: Message[], messagesInResponse: Message[]): boolean => {\r\n    // return true (messages are equal) because there is no messages in both response and state\r\n    if (!messages[0] || !messagesInResponse[0]) return true\r\n    const lastIdInResponse = messagesInResponse[messagesInResponse.length - 1].id\r\n    const lastIdInState = messages[messages.length - 1].id\r\n    return lastIdInResponse === lastIdInState\r\n}\r\nexport const fetchMessages = (): AsyncThunk => async (dispatch, getState)=> {\r\n    try {\r\n        const {count, dialogUserId} = getState().messagesPage\r\n        const messagesResponse = await dialogsService.requireMessages(dialogUserId, count, 1)\r\n        const {messages, messagesError} = getState().messagesPage\r\n        if (messagesError) dispatch(messagesActions.clearMessagesError())\r\n        const haveNewMessages = !isLastMessageIdEqual(messages, messagesResponse.items)\r\n        if (haveNewMessages) {\r\n            dispatch(messagesActions.updateMessages(messagesResponse.items))\r\n            dispatch(messagesActions.setTotalMessagesCount(messagesResponse.totalCount))\r\n        }\r\n    } catch {\r\n        dispatch(appActions.addError(\"Can't load messages\"))\r\n    }\r\n}\r\n\r\nexport const loadMoreMessages = (): AsyncThunk => async (dispatch, getState) => {\r\n    const {dialogUserId, messages, pageNumber, status} = getState().messagesPage\r\n    const {totalCount: totalCountInResponse} = await dialogsService.requireLastMessage(dialogUserId)\r\n\r\n    if (totalCountInResponse === messages.length) {\r\n        if(!status.allMessagesIsLoaded) dispatch(messagesActions.setIsAllMessagesLoaded(true))\r\n        return\r\n    }\r\n\r\n    dispatch(messagesActions.setIsMessagesFetching(true))\r\n    if (status.allMessagesIsLoaded) dispatch(messagesActions.setIsAllMessagesLoaded(false))\r\n    dispatch(messagesActions.setPageNumber(pageNumber + 1))\r\n    try {\r\n        const {pageNumber, count} = getState().messagesPage\r\n        const messagesResponse = await dialogsService.requireMessages(dialogUserId, count, pageNumber)\r\n        dispatch(messagesActions.setMoreMessages(messagesResponse.items))\r\n        dispatch(messagesActions.setTotalMessagesCount(messagesResponse.totalCount))\r\n    } catch {\r\n        const {pageNumber} = getState().messagesPage\r\n        dispatch(messagesActions.setPageNumber(pageNumber - 1))\r\n        dispatch(appActions.addError(\"Can't load messages\"))\r\n    }\r\n    dispatch(messagesActions.setIsMessagesFetching(false))\r\n}\r\n\r\nexport const sendNewMessage = (formData: NewMessageFormData): AsyncThunk => async (dispatch, getState)=> {\r\n    const id = getState().messagesPage.dialogUserId\r\n    try {\r\n        const sendRequestResponse = await dialogsService.sendMessage(id, formData)\r\n        if (sendRequestResponse.resultCode === ResultCodes.Success) {\r\n            const sentMessage = sendRequestResponse.data.message\r\n            dispatch(messagesActions.addNewMessage(sentMessage))\r\n        } else dispatch(appActions.addError(sendRequestResponse.messages[0]))\r\n    } catch {\r\n        dispatch(appActions.addError(\"Can't send message\"))\r\n    }\r\n}\r\n","var _path;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgSend(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 180,\n    height: 190,\n    viewBox: \"0 0 18 19\",\n    fill: \"white\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M10.7537 18.0376C11.4324 18.0376 11.8933 17.5097 12.2117 16.6969L17.7671 2.16736C17.9095 1.79868 17.985 1.47189 17.985 1.19537C17.985 0.558552 17.5828 0.15635 16.9459 0.15635C16.6694 0.15635 16.3426 0.231763 15.9739 0.374209L1.38574 5.95477C0.648368 6.23966 0.10372 6.70889 0.10372 7.38761C0.10372 8.20877 0.707023 8.53556 1.54494 8.78694L5.75969 10.0773C6.37975 10.2701 6.74844 10.2617 7.19253 9.85948L16.6191 1.17023C16.7448 1.0613 16.8873 1.06968 16.9795 1.16186C17.0716 1.24565 17.08 1.40485 16.9711 1.52216L8.30697 10.9572C7.9299 11.3677 7.88801 11.7867 8.07235 12.3984L9.33761 16.5377C9.59737 17.4008 9.92416 18.0376 10.7537 18.0376Z\",\n    fill: \"white\"\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgSend);\nexport default __webpack_public_path__ + \"static/media/send.2ec83b7d2370fbd448eddc161ecfe473.svg\";\nexport { ForwardRef as ReactComponent };","import React, {FC} from \"react\";\r\nimport {FormApi} from \"final-form\";\r\nimport {Field, Form} from \"react-final-form\";\r\nimport send from \"../../../common/assets/img/send.svg\";\r\n\r\nexport interface NewMessageForm {\r\n    body: string\r\n}\r\n\r\nconst NewMessage: FC<{sendMessage: (formData: any) => void}> = ({sendMessage}) => {\r\n    const sendMessageOnEnter = (e: React.KeyboardEvent, form: FormApi<NewMessageForm>) => {\r\n        if (e.key === 'Enter') {\r\n            e.preventDefault()\r\n            form.submit()\r\n            form.reset()\r\n        }\r\n    }\r\n    const handleClick = (form: FormApi<NewMessageForm>) => {\r\n        form.submit()\r\n        form.reset()\r\n    }\r\n    return (\r\n        <div className=\"message-text-container\">\r\n            <Form\r\n                onSubmit={sendMessage}\r\n                render={\r\n                    ({handleSubmit, submitting, pristine, form}) => (\r\n                        <form className='add-message-form' onSubmit={handleSubmit}>\r\n                            <Field\r\n                                onKeyDown={\r\n                                    (e: React.KeyboardEvent) => sendMessageOnEnter(e, form)\r\n                                }\r\n                                name='body'\r\n                                component='textarea'\r\n                                placeholder='Text a message'\r\n                            />\r\n                            <button\r\n                                disabled={submitting || pristine}\r\n                                onClick={() => handleClick(form)}\r\n                            >\r\n                                <img src={send} alt=\"\"/>\r\n                            </button>\r\n                        </form>\r\n                )}\r\n            />\r\n        </div>\r\n    )\r\n}\r\nexport default NewMessage;","import React, {FC} from 'react';\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport {RootState} from \"../../../redux/redux-store\";\r\nimport userImg from \"../../../common/assets/img/userIcon.jpg\";\r\nimport {NavLink} from \"react-router-dom\";\r\n\r\nconst ConversationHead: FC<ConversationHeadProps> = ({conversationHead}) => {\r\n    const headerImage = conversationHead.photo ? conversationHead.photo : userImg\r\n    return (\r\n        <NavLink\r\n            replace\r\n            to={`/profile/${conversationHead.id}`}\r\n            className=\"conversation-head\"\r\n        >\r\n            <figure>\r\n                <img src={headerImage} alt=\"\"/>\r\n            </figure>\r\n            <span>{conversationHead.userName}</span>\r\n        </NavLink>\r\n    );\r\n};\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n    conversationHead: state.dialogsPage.conversationHead\r\n})\r\n\r\nconst connector = connect(mapStateToProps, {})\r\n\r\nexport default connector(ConversationHead)\r\nexport type ConversationHeadProps = ConnectedProps<typeof connector>","import {useCallback, useEffect, useRef, useState} from \"react\";\r\nimport debounce from 'lodash.debounce'\r\nimport {MessagesRequestStatus} from \"../../../types/MessagesTypes\";\r\n\r\nconst isElementScrolledUp = (chatRef: HTMLElement | null): boolean => {\r\n    if (!chatRef) return false\r\n    const availableScrollHeight = chatRef.scrollHeight - chatRef.offsetHeight - 32\r\n    return (chatRef.scrollTop + 70) < availableScrollHeight\r\n}\r\nconst scrollChatToBottom = (chatRef: HTMLElement | null) => {\r\n    if (!chatRef) return\r\n    const scrolledUp = isElementScrolledUp(chatRef)\r\n    if (!scrolledUp) chatRef.scrollTop = chatRef.scrollHeight\r\n}\r\n\r\nexport const useFetchMessages = (\r\n    messages: JSX.Element[],\r\n    chatRef: HTMLElement | null ,\r\n    scrolledOnChatLoad: { current: boolean },\r\n    status: MessagesRequestStatus\r\n) => {\r\n\r\n    useEffect(() => {\r\n        scrollChatToBottom(chatRef)\r\n    }, [messages])\r\n\r\n    useEffect(() => {\r\n        if (!status.isLoading && !scrolledOnChatLoad.current) {\r\n            if (chatRef) chatRef.scrollTop = chatRef.scrollHeight\r\n            scrolledOnChatLoad.current = true\r\n        }\r\n    }, [status.isLoading])\r\n\r\n    useEffect(\r\n        () => {\r\n            const needToScroll = !status.isFetching && !status.allMessagesIsLoaded\r\n            if (chatRef && needToScroll) chatRef.scrollTop = 1100\r\n        }, [status.isFetching]\r\n    )\r\n\r\n}\r\n\r\nexport const useScrollChat = (\r\n    loadMoreMessages: () => void,\r\n    chatRef: HTMLElement | null,\r\n    scrolledOnChatLoad: { current: boolean },\r\n) => {\r\n\r\n    const [showScrollButton, setShowScrollButton] = useState<boolean>(false)\r\n    const messagesLoadWithDebounce = useCallback(debounce(loadMoreMessages, 500), [])\r\n    const handleScroll = () => {\r\n        isElementScrolledUp(chatRef)\r\n            ? !showScrollButton && setShowScrollButton(true)\r\n            : showScrollButton && setShowScrollButton(false)\r\n\r\n        if (!chatRef) return\r\n        const scrolledToTop = chatRef.scrollTop < 30\r\n        if (scrolledToTop && scrolledOnChatLoad) messagesLoadWithDebounce()\r\n    }\r\n\r\n    const handleScrollClick = () => {\r\n        if (chatRef) chatRef.scrollTop = chatRef.scrollHeight\r\n    }\r\n\r\n    return {handleScrollClick, handleScroll, showScrollButton}\r\n}","import React, {FC, useRef, useState} from \"react\";\r\nimport {useParams} from \"react-router-dom\";\r\nimport Preloader from \"../../../preloaders/Preloader\";\r\nimport {MessagesPropsType} from \"./MessagesContainer\";\r\nimport NewMessage from \"./NewMessage\";\r\nimport ConversationHead from \"./ConversationHead\";\r\nimport {useFetchMessages, useScrollChat} from \"./hooks\";\r\nimport {NewMessageFormData} from \"../../../types/MessagesTypes\";\r\nimport arrow from '../../../common/assets/img/icons/down-arrow.png'\r\nimport PerfectScrollbar from \"react-perfect-scrollbar\";\r\n\r\n\r\nconst Messages: FC<MessagesPropsType> = ({\r\n    messages, sendNewMessage, status, loadMoreMessages\r\n}) => {\r\n    const userId = Number(useParams().userId);\r\n    const sendMessage = (formData: NewMessageFormData) => sendNewMessage(formData)\r\n    const [chatRef, setChatRef] = useState<HTMLElement | null >(null)\r\n    const scrolledOnChatLoad = useRef<boolean>(false)\r\n    useFetchMessages(messages, chatRef, scrolledOnChatLoad, status)\r\n    const {\r\n        handleScrollClick, handleScroll, showScrollButton\r\n    } = useScrollChat(loadMoreMessages, chatRef, scrolledOnChatLoad)\r\n    const getChatRef = (chatRef: HTMLElement) => setChatRef(chatRef)\r\n    return (\r\n        <div className=\"peoples-mesg-box\">\r\n            {userId &&\r\n                <div className='chatArea opacity-animation'>\r\n                    <ConversationHead/>\r\n                    <PerfectScrollbar\r\n                        className=\"chatting-area\"\r\n                        component='ul'\r\n                        containerRef={getChatRef}\r\n                        onScroll={handleScroll}\r\n                    >\r\n                        <Preloader\r\n                            isFetching={status.isFetching}\r\n                            size='small'\r\n                        />\r\n                        {status.isLoading && <Preloader />}\r\n                        {messages[0]\r\n                            ? !status.isLoading && messages\r\n                            : !status.isLoading && (\r\n                                <div className='preloader'>\r\n                                    You've got no messages yet.\r\n                                </div>\r\n                              )\r\n                        }\r\n                    </PerfectScrollbar>\r\n                    {showScrollButton &&\r\n                        <img\r\n                            src={arrow} alt=\"\"\r\n                            className=\"scroll-bottom opacity-animation\"\r\n                            onClick={handleScrollClick}\r\n                        />\r\n                    }\r\n                    <NewMessage sendMessage={sendMessage}/>\r\n                </div>\r\n            }\r\n            {!userId &&\r\n                <div className='fetch-error'>Choose friend to start chat</div>\r\n            }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Messages\r\n\r\n","import React, {FC, useEffect} from \"react\";\r\nimport {useParams} from \"react-router-dom\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\n\r\nimport {RootState} from \"../../../redux/redux-store\";\r\nimport Dialogs from \"./Dialogs/Dialogs\";\r\n\r\nimport {\r\n    fetchMessages, loadMessages, loadMoreMessages, sendNewMessage\r\n} from \"../../../redux/reducers/messages-reducer/middleware\";\r\nimport Messages from \"./Messages\";\r\nimport {\r\n    getMessagesPageNumber,\r\n    getMessagesRequestStatus, getTotalMessagesCount, messagesReselect\r\n} from \"../../../redux/selectors/messagesSelector\";\r\nimport {\r\n    setDialogUserId, setIsAllMessagesLoaded, setPageNumber\r\n} from \"../../../redux/reducers/messages-reducer/actions\";\r\n\r\n\r\nconst MessagesContainer: FC<MessagesPropsType> = (props) => {\r\n    const userId = Number(useParams().userId);\r\n\r\n    useEffect(() => {\r\n        if (userId) {\r\n            props.setDialogUserId(userId)\r\n            props.loadMessages()\r\n        }\r\n        const setFetchInterval = (): NodeJS.Timer | false => {\r\n            if (userId) return setInterval(() => props.fetchMessages(), 1500)\r\n            else return false\r\n        }\r\n        const fetchInterval = setFetchInterval()\r\n        return () => {if (fetchInterval) clearInterval(fetchInterval)}\r\n    }, [userId])\r\n\r\n    return (\r\n        <div className=\"central-meta messages\">\r\n            <div className=\"messages\">\r\n                <div className=\"message-box\">\r\n                    <Dialogs />\r\n                    <Messages {...props}/>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => {\r\n    return {\r\n        messages: messagesReselect(state),\r\n        totalMessagesCount: getTotalMessagesCount(state),\r\n        pageNumber: getMessagesPageNumber(state),\r\n        status: getMessagesRequestStatus(state)\r\n    }\r\n}\r\n\r\nconst connector = connect(\r\n    mapStateToProps,\r\n    {\r\n        sendNewMessage, loadMessages, fetchMessages, setIsAllMessagesLoaded,\r\n        setPageNumber, loadMoreMessages, setDialogUserId\r\n    }\r\n)\r\n\r\nexport default connector(MessagesContainer);\r\n\r\nexport type MessagesPropsType = ConnectedProps<typeof connector>"],"names":["searchMode","setSearchMode","className","onClick","icon","faXmark","faSquarePlus","filterDialogs","setDialogs","userId","Number","useParams","faSearch","onSubmit","formData","searchBody","render","handleSubmit","form","name","autoFocus","validate","required","onKeyUp","e","isSearchFieldEmpty","submit","handleKeyUp","component","placeholder","connect","state","useState","UsersContainer","startDialogOnClick","DialogsList","messagesActions","messages","type","count","newMessages","newMessage","pageNumber","isLoaded","isLoading","isFetching","setPageNumber","setDialogUserId","setIsAllMessagesLoaded","isLastMessageIdEqual","messagesInResponse","length","id","sendMessage","submitting","pristine","onKeyDown","key","preventDefault","reset","sendMessageOnEnter","disabled","handleClick","src","send","alt","conversationHead","dialogsPage","headerImage","photo","userImg","replace","to","userName","isElementScrolledUp","chatRef","availableScrollHeight","scrollHeight","offsetHeight","scrollTop","useFetchMessages","scrolledOnChatLoad","status","useEffect","scrollChatToBottom","current","needToScroll","allMessagesIsLoaded","sendNewMessage","loadMoreMessages","setChatRef","useRef","showScrollButton","setShowScrollButton","messagesLoadWithDebounce","useCallback","debounce","handleScrollClick","handleScroll","useScrollChat","containerRef","onScroll","Preloader","size","connector","messagesReselect","totalMessagesCount","getTotalMessagesCount","getMessagesPageNumber","getMessagesRequestStatus","dispatch","getState","messagesPage","dialogUserId","dialogsService","sendRequestResponse","resultCode","ResultCodes","sentMessage","data","message","appActions","loadMessages","dialogsActions","messagesResponse","items","totalCount","fetchMessages","messagesError","props","fetchInterval","setInterval","clearInterval"],"sourceRoot":""}