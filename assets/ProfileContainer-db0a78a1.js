import{r as u,j as a,c as I,a as o,P as S,F as P,R as F,b as L,f as T,d as O,e as U,g as h,h as R,u as x,p as _,i as N,k as j,l as M,m as k,n as B,M as D,o as $,U as J,q as H,s as E,t as q,v as G,w as y,x as v,y as V,z as W,A as z,B as Y,C as K,D as Q,E as X,G as Z,H as ee}from"./index-3fd4c2dc.js";const oe="_whiteBg_dl5pa_1",te="_transparent_dl5pa_6",ie="_jobStyle_dl5pa_10",re="_green_dl5pa_20",se="_red_dl5pa_26",ae="_icon_dl5pa_44",ne="_additionalInf_dl5pa_49",le="_additionalInfActive_dl5pa_69",ce="_editPhoto_dl5pa_102",de="_fileContainer_dl5pa_125",fe="_userAvatar_dl5pa_139",ue="_fileInput_dl5pa_158",me="_profileData_dl5pa_172",pe="_hidden_dl5pa_176",Pe="_shown_dl5pa_183",he="_profileHeader_dl5pa_190",f={whiteBg:oe,transparent:te,jobStyle:ie,green:re,red:se,icon:ae,additionalInf:ne,additionalInfActive:le,editPhoto:ce,fileContainer:de,userAvatar:fe,fileInput:ue,profileData:me,hidden:pe,shown:Pe,profileHeader:he},ge=u.memo(({profile:e,isMyProfile:t,profileEditMode:i})=>{const r=e.lookingForAJob?f.green:f.red;return a("div",{className:I(f.profileData,i?f.hidden:f.shown),children:[a("div",{className:"admin-name timeline-info__row",children:[o("h5",{children:e.fullName}),o(S,{isMyProfile:t})]}),o("div",{className:"timeline-info__row",children:a("div",{className:"lookingForAJob",children:[e.aboutMe&&e.aboutMe!==""&&a("div",{className:"small-subtitle",children:[o(P,{icon:"fa-solid fa-address-card"}),o("span",{className:"text",children:"About:"}),e.aboutMe]}),o("div",{className:"lookingForAJobDescription",children:e.lookingForAJobDescription}),a("div",{className:f.jobStyle,children:[o(P,{icon:"fa fa-briefcase",className:f.icon}),"Job status:",o("span",{className:r,children:e.lookingForAJob?" looking for a job":" not interested in job"})]})]})})]})}),_e=({errorText:e})=>o("div",{className:"local-error",children:o("span",{className:"text",children:e})}),be=({onSubmit:e})=>o(F,{onSubmit:e,render:({handleSubmit:t})=>a("form",{onSubmit:t,children:[o(L,{name:"postBody",initialValue:"Posts will be available later...",component:"textarea"}),a("div",{className:"attachments",children:[a("div",{className:"icons",children:[o(P,{icon:T}),o(P,{icon:O})]}),o("button",{type:"button",disabled:!0,className:"add-butn",children:"Post"})]})]})}),Ne=({addPostActionCreator:e})=>o("div",{className:"new-postbox",children:o("div",{className:"newpst-input",children:o(be,{onSubmit:i=>{e(i)}})})}),Ee=e=>a("div",{className:"loadMore opacity-animation",children:[o(Ne,{state:e.state,onPostChange:e.onPostChange,addPostActionCreator:e.addPostActionCreator,postNewText:e.postNewText,profileImg:e.profileImg}),e.postList]}),Ie="https://nikitashevchuk.github.io/social-network/assets/profileCover-7deba932.jpg",ye=e=>o("div",{className:"user-post",children:a("div",{className:"friend-info",children:[o("figure",{children:o("img",{src:e.profileImg,alt:""})}),a("div",{className:"friend-name",children:[o("ins",{children:o("a",{href:e.userName,title:"",children:e.userName})}),o("span",{children:"published: june,2 2018 19:PM"})]}),a("div",{className:"post-meta",children:[o("img",{src:Ie,alt:""}),o("div",{className:"description",children:o("p",{children:e.postText})})]})]})}),ve=e=>e.postPage.posts,Se=e=>{var t;return(t=e.profilePage.profile)==null?void 0:t.photos.small},Fe=e=>e.profilePage.profile.fullName,Me=U(ve,Se,Fe,(e,t,i)=>e.map(r=>o(ye,{postText:r.postText,likesCount:r.likesCount,profileImg:t,userName:i},r.id))),ke=e=>({postList:Me(e),profileImg:e.auth.profileImg}),we=h(ke,{addPostActionCreator:R})(Ee),Ae=u.memo(({onPhotoUpload:e})=>o("form",{className:f.editPhoto,children:a("span",{className:f.fileContainer,children:["Edit profile photo",o("input",{onChange:e,className:f.fileInput,type:"file",accept:".jpg, .jpeg, .png"})]})})),c={ableButton:()=>({type:"profile-reducer/ABLE_BUTTON"}),disableButton:()=>({type:"profile-reducer/DISABLE_BUTTON"}),followUserProfile:()=>({type:"profile-reducer/FOLLOW_USER"}),unfollowUserProfile:()=>({type:"profile-reducer/UNFOLLOW_USER"}),isPhotoUpdating:e=>({type:"profile-reducer/PHOTO_UPDATING",isUpdating:e}),setProfileEditMode:e=>({type:"profile-reducer/SET_PROFILE_EDIT_MODE",isInEditMode:e}),setSocialMediaEditMode:e=>({type:"profile-reducer/SET_SOCIAL_MEDIA_EDIT_MODE",isInEditMode:e}),photoUploadedSuccessfully:e=>({type:"profile-reducer/UPD_PHOTO",photos:e}),setUpdatedProfile:e=>({type:"profile-reducer/UPDATE_PROFILE",profile:e}),setIsProfileLoading:e=>({type:"profile-reducer/SET_IS_PROFILE_LOADING",isLoading:e}),setProfile:e=>({type:"profile-reducer/SET_PROFILE",profile:e}),setStatus:e=>({type:"profile-reducer/SET_STATUS",status:e}),setUserId:e=>({type:"profile-reducer/SET_USER_ID",userId:e}),setIsMyProfile:e=>({type:"profile-reducer/SET_IS_MY_PROFILE",isMyProfile:e}),addLocalError:e=>({type:"profile-reducer/ADD_LOCAL_ERROR",localError:e}),addProfileFetchError:e=>({type:"profile-reducer/ADD_PROFILE_FETCH_ERROR",errorText:e}),removeProfileFetchError:()=>({type:"profile-reducer/REMOVE_PROFILE_FETCH_ERROR"})},{setProfileEditMode:w,setUserId:Ce,setIsMyProfile:Le,setSocialMediaEditMode:A}=c,Te=e=>async t=>{t(c.setIsProfileLoading(!0));try{const i=await x.isFollowing(e);t(i?c.followUserProfile():c.unfollowUserProfile());const r=await _.getProfile(e);t(c.setProfile(r));const s=await _.getStatus(e);t(c.setStatus(s)),t(c.removeProfileFetchError())}catch{t(c.addProfileFetchError("Can't load profile"))}t(c.setIsProfileLoading(!1))},Oe=()=>(e,t)=>{e(c.setIsProfileLoading(!0));const i=t().auth.clientProfile;i.userId!==0&&e(c.setProfile(i)),e(c.setIsProfileLoading(!1))},Ue=e=>async t=>{t(c.isPhotoUpdating(!0));try{const i=await _.uploadPhoto(e);i.resultCode===N.Success?(t(j.setUserPhoto(i.data.photos.large)),t(c.photoUploadedSuccessfully(i.data.photos))):(t(c.addLocalError(i.messages[0])),setTimeout(()=>{t(c.addLocalError(""))},5e3))}catch{t(M.addError("Network error"))}t(c.isPhotoUpdating(!1))},Re=e=>async t=>{try{const i=await _.updateProfile(e);i.resultCode===N.Success?t(c.setUpdatedProfile(e)):i.resultCode===N.Error&&(t(c.addLocalError(i.messages[0])),setTimeout(()=>{t(c.addLocalError(""))},5e3))}catch{t(M.addError("Network error"))}},xe=({isMyProfile:e,disableWhileRequest:t,followed:i,enterEditMode:r,userId:s,profileEditMode:n})=>o("div",{className:"profile-buttons",children:e?!n&&o("button",{type:"button",onClick:r,className:"add-butn transparent",children:"Edit profile"}):a(k,{children:[o(B,{followed:i,userId:s,disabled:t}),o(D,{userId:s})]})}),je=({setProfileEditMode:e,isMyProfile:t,userId:i,disableWhileRequest:r,followed:s,profileEditMode:n})=>o(xe,{isMyProfile:t,disableWhileRequest:r,enterEditMode:()=>e(!0),followed:s,userId:i,profileEditMode:n}),Be=e=>({followed:e.profilePage.followed,disableWhileRequest:e.profilePage.disableWhileRequest,isMyProfile:e.profilePage.isMyProfile,userId:e.profilePage.userIdParam,profileEditMode:e.profilePage.profileEditMode}),De=h(Be,{setProfileEditMode:w}),$e=De(je),Je=({profileLargePhoto:e,photoIsUpdating:t,isMyProfile:i,updatePhoto:r})=>{const s=e&&!t?f.transparent:f.whiteBg,n=d=>{const l=d.target.files?d.target.files[0]:null;l&&r(l)};return a("div",{className:f.profileHeader,children:[o("div",{className:f.userAvatar,children:a("figure",{className:s,children:[t?o($,{}):o(J,{profileImg:e}),i&&o(Ae,{onPhotoUpload:n})]})}),o($e,{})]})},He=e=>({photoIsUpdating:e.profilePage.photoIsUpdating,isMyProfile:e.profilePage.isMyProfile}),qe=h(He,{updatePhoto:Ue}),Ge=qe(Je),Ve=e=>({...e,contacts:{github:e.github,vk:null,facebook:e.facebook,instagram:e.instagram,twitter:e.twitter,website:null,youtube:e.youtube,mainLink:null}}),We=(e,t)=>!t||e==="vk"||e==="website"||e==="mainLink",ze=e=>u.useMemo(()=>e.map(i=>{const r=i[0],s=i[1];return We(r,s)?"":o("div",{className:"social-media__element",children:o("a",{href:`${s}`,target:"_blank",rel:"noreferrer",children:o(P,{icon:["fab",`fa-${r}`]})})},e.indexOf(i))}),[e]),Ye=()=>u.useMemo(()=>{const e=q("userId"),t=G("lookingForAJob",null,{active:" looking for a job",inactive:" not interested in job"}),i=H([y],"lookingForAJobDescription"),r=E([v,V,W],"text","fullName"),s=E([v,y],"text","aboutMe");return{fullNameField:r,userIdField:e,jobDescriptionField:i,jobCheckBox:t,aboutMeField:s}},[]),Ke=e=>{const t=JSON.parse(JSON.stringify(e));return Object.entries(e).forEach(s=>{const[n,d]=s;typeof d!="boolean"&&!d&&d!==""&&(t[n]="")}),Object.entries(t.contacts).forEach(([s,n])=>{!n&&n!==""&&(t.contacts[s]="")}),t},Qe=e=>e==="website"||e==="vk"||e==="mainLink",Xe=({contactsArray:e})=>{const t=z(),{socialMediaEditMode:i}=Y(l=>l.profilePage),r=i?f.additionalInfActive:f.additionalInf,s=u.useRef(null);K({callback:l=>t(A(l)),exceptions:["edit-social-media"],ref:s});const d=u.useMemo(()=>e.map(l=>{const m=l[0];return Qe(m)?"":E([Q],"text",l[0],l[0])}),[]);return o("div",{ref:s,className:I(r,"links-form"),children:d})},Ze=u.forwardRef(({submitting:e,pristine:t,handleSubmit:i,disableEditMode:r,isMyProfile:s,profileEditMode:n,contactsArray:d},l)=>{const{fullNameField:m,userIdField:p,jobDescriptionField:g,jobCheckBox:b,aboutMeField:C}=Ye();return a("form",{className:I(n?"profile-data shown":"profile-data hidden","edit-profile-form"),onSubmit:i,ref:l,children:[a("div",{className:"admin-name timeline-info__row",children:[p,o("h5",{children:m}),o(S,{isMyProfile:s})]}),o("div",{className:"timeline-info__row",children:a("div",{className:"lookingForAJob",children:[a("div",{className:"small-subtitle",children:[o(P,{icon:"fa-solid fa-address-card"}),o("span",{className:"text",children:"About:"}),C]}),o("div",{className:"lookingForAJobDescription-edit",children:g}),a("div",{className:f.jobStyle,children:[o(P,{icon:"fa fa-briefcase",className:f.icon}),o("span",{children:"Job status:"}),b]})]})}),a("div",{className:"edit-profile-buttons",children:[o("button",{type:"submit",disabled:e||t,className:"add-butn",children:"Save"}),o("button",{type:"button",onClick:r,className:"add-butn white",children:"Cancel"})]}),o(Xe,{contactsArray:d})]})}),eo=u.memo(({updateProfile:e,isMyProfile:t,profile:i,contactsArray:r,setProfileEditMode:s,profileEditMode:n})=>{const d=u.useRef(null),l=p=>{const g=Ve(p);e(g),s(!1)},m=()=>s(!1);return o(F,{initialValues:Ke({...i,...i.contacts}),onSubmit:l,render:({handleSubmit:p,submitting:g,pristine:b})=>o(Ze,{ref:d,pristine:b,submitting:g,handleSubmit:p,isMyProfile:t,profileEditMode:n,disableEditMode:m,contactsArray:r})})}),oo=e=>({contactsArray:e.profilePage.contactsArray}),to=h(oo,{updateProfile:Re,setProfileEditMode:w}),io=to(eo),ro=({contactsArray:e,profileEditMode:t,contacts:i,socialMediaEditMode:r,setSocialMediaEditMode:s})=>{const n=()=>t&&s(!r),d=Object.values(i).find(m=>m!==null),l=ze(e);return!d&&!t?o("span",{}):o("div",{className:"additional-profile-info",children:a("div",{className:"social-media",children:[l,!d&&t&&o("span",{className:"text",children:"Add your social media links"}),t&&o("div",{className:`edit-social-media ${r?"close-icon":"edit-icon"}`,onClick:n})]})})},so=e=>({socialMediaEditMode:e.profilePage.socialMediaEditMode,contactsArray:e.profilePage.contactsArray}),ao=h(so,{setSocialMediaEditMode:A}),no=ao(ro),lo=u.memo(({profile:e,loadProfile:t,isMyProfile:i,localError:r,profileIsLoading:s,profileEditMode:n,userId:d,profileFetchError:l})=>{var p;const m=()=>t(d);return s&&!r?o(X,{}):a("div",{className:"central-meta",children:[r&&o(_e,{errorText:r}),l&&o(Z,{refetch:m,errorText:l}),!l&&a(k,{children:[a("div",{className:"bg",children:[a("div",{className:"timeline-info",children:[o(Ge,{profileLargePhoto:(p=e.photos)==null?void 0:p.large}),o(io,{profile:e,profileEditMode:n,isMyProfile:i}),o(ge,{profileEditMode:n,isMyProfile:i,profile:e})]}),o(no,{contacts:e.contacts,profileEditMode:n})]}),o(we,{})]})]})}),co=e=>{const t=ee().userId;return u.useEffect(()=>{const i=t?Number(t):e.myId;e.setUserId(i),i===e.myId||i===0?(e.setIsMyProfile(!0),e.getMyProfileFromState()):(e.setIsMyProfile(!1),e.loadProfile(i))},[t,e.myId]),o(lo,{...e})},fo=e=>({profile:e.profilePage.profile,myId:e.auth.userData.id,localError:e.profilePage.localError,isMyProfile:e.profilePage.isMyProfile,profileEditMode:e.profilePage.profileEditMode,userId:e.profilePage.userIdParam,profileFetchError:e.profilePage.profileFetchError,profileIsLoading:e.profilePage.profileIsLoading}),uo=h(fo,{loadProfile:Te,setIsMyProfile:Le,setUserId:Ce,getMyProfileFromState:Oe}),Po=uo(co);export{Po as default};
